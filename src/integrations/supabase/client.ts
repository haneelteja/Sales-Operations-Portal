// This file is automatically generated. Do not edit it directly.
import { createClient } from '@supabase/supabase-js';
import type { Database } from './types';

// Force new project configuration - clear any cached values
// Use environment variables for configuration
const SUPABASE_URL = import.meta.env.VITE_SUPABASE_URL || "https://qkvmdrtfhpcvwvqjuyuu.supabase.co";
const SUPABASE_PUBLISHABLE_KEY = import.meta.env.VITE_SUPABASE_ANON_KEY || "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFrdm1kcnRmaHBjdnd2cWp1eXV1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTkyMjgyMTgsImV4cCI6MjA3NDgwNDIxOH0.DJeoI0LFeMArVs5s6DV2HP0kYnjWcIVLQEbiCQr97CE";

// Clear any cached auth data
if (typeof window !== 'undefined') {
  localStorage.removeItem('supabase.auth.token');
  localStorage.removeItem('supabase.auth.refresh_token');
  localStorage.removeItem('sb-yltbknkksjgtexluhtau-auth-token');
  localStorage.removeItem('sb-yltbknkksjgtexluhtau-auth-refresh-token');
  localStorage.removeItem('sb-qkvmdrtfhpcvwvqjuyuu-auth-token');
  localStorage.removeItem('sb-qkvmdrtfhpcvwvqjuyuu-auth-refresh-token');
}

// Import the supabase client like this:
// import { supabase } from "@/integrations/supabase/client";

export const supabase = createClient<Database>(SUPABASE_URL, SUPABASE_PUBLISHABLE_KEY, {
  auth: {
    storage: localStorage,
    persistSession: true,
    autoRefreshToken: true,
  },
  // Add better error handling
  global: {
    headers: {
      'x-client-info': 'aamodha-operations-portal'
    }
  }
});

// Helper function to handle Supabase errors with better messages
export const handleSupabaseError = (error: any): string => {
  if (!error) return 'An unknown error occurred';
  
  // Handle network/SSL errors
  if (error.message?.includes('ERR_CERT_AUTHORITY_INVALID') || 
      error.message?.includes('certificate') ||
      error.message?.includes('SSL')) {
    return 'SSL certificate error. Please check your network connection or contact support.';
  }
  
  // Handle 400 Bad Request errors
  if (error.code === 'PGRST116' || error.message?.includes('400')) {
    return 'Invalid request. Please check your query parameters and try again.';
  }
  
  // Handle RLS (Row Level Security) errors
  if (error.code === '42501' || error.message?.includes('permission') || error.message?.includes('RLS')) {
    return 'Permission denied. Please check your access rights.';
  }
  
  // Return the error message if available
  return error.message || 'An error occurred while processing your request';
};